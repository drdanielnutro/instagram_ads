Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"{\n  \"grade\": \"pass\",\n  \"comment\": \"A análise semântica e visual de todas as variações foi concluída. Cada variação está perfeitamente alinhada com o briefing, o objetivo de vendas e a narrativa StoryBrand. A Variação 1 foca na jornada da 'vergonha' ao 'orgulho'. A Variação 2 aborda o ângulo da 'segurança' e 'alívio'. A Variação 3 foca no dilema do 'preço justo' e na 'satisfação' da compra inteligente. Em todos os casos, a consistência entre copy e visual é exemplar, e os prompts de imagem são coerentes e acionáveis. Não há problemas de conformidade. O conjunto está aprovado.\"\n}"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-6.447440324429267}],"create_time":"2025-10-26T13:02:06.988691Z","response_id":"zhv-aJOsPMO-gLUP5a-XiQo","model_version":"gemini-2.5-pro","usage_metadata":{"cache_tokens_details":[{"modality":"TEXT","token_count":25842}],"cached_content_token_count":25842,"candidates_token_count":167,"candidates_tokens_details":[{"modality":"TEXT","token_count":167}],"prompt_token_count":27309,"prompt_tokens_details":[{"modality":"TEXT","token_count":27309}],"thoughts_token_count":3220,"total_token_count":30696,"traffic_type":"ON_DEMAND"},"automatic_function_calling_history":[],"parsed":{"grade":"pass","comment":"A análise semântica e visual de todas as variações foi concluída. Cada variação está perfeitamente alinhada com o briefing, o objetivo de vendas e a narrativa StoryBrand. A Variação 1 foca na jornada da 'vergonha' ao 'orgulho'. A Variação 2 aborda o ângulo da 'segurança' e 'alívio'. A Variação 3 foca no dilema do 'preço justo' e na 'satisfação' da compra inteligente. Em todos os casos, a consistência entre copy e visual é exemplar, e os prompts de imagem são coerentes e acionáveis. Não há problemas de conformidade. O conjunto está aprovado."}}
-----------------------------------------------------------

INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"{\n  \"grade\": \"pass\",\n  \"comment\": \"A análise semântica e visual de todas as variações foi concluída. Cada variação está perfeitamente alinhada com o briefing, o objetivo de vendas e a narrativa StoryBrand. A Variação 1 foca na jornada da 'vergonha' ao 'orgulho'. A Variação 2 aborda o ângulo da 'segurança' e 'alívio'. A Variação 3 foca no dilema do 'preço justo' e na 'satisfação' da compra inteligente. Em todos os casos, a consistência entre copy e visual é exemplar, e os prompts de imagem são coerentes e acionáveis. Não há problemas de conformidade. O conjunto está aprovado.\"\n}"}],"role":"model"},"usageMetadata":{"cacheTokensDetails":[{"modality":"TEXT","tokenCount":25842}],"cachedContentTokenCount":25842,"candidatesTokenCount":167,"candidatesTokensDetails":[{"modality":"TEXT","tokenCount":167}],"promptTokenCount":27309,"promptTokensDetails":[{"modality":"TEXT","tokenCount":27309}],"thoughtsTokenCount":3220,"totalTokenCount":30696,"trafficType":"ON_DEMAND"},"invocationId":"e-e4ef633d-823c-4f29-884a-7245ca2762cc","author":"semantic_visual_reviewer","actions":{"stateDelta":{"semantic_visual_review":{"grade":"pass","comment":"A análise semântica e visual de todas as variações foi concluída. Cada variação está perfeitamente alinhada com o briefing, o objetivo de vendas e a narrativa StoryBrand. A Variação 1 foca na jornada da 'vergonha' ao 'orgulho'. A Variação 2 aborda o ângulo da 'segurança' e 'alívio'. A Variação 3 foca no dilema do 'preço justo' e na 'satisfação' da compra inteligente. Em todos os casos, a consistência entre copy e visual é exemplar, e os prompts de imagem são coerentes e acionáveis. Não há problemas de conformidade. O conjunto está aprovado."}},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"F5qmSQBX","timestamp":1761483849.667286}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"invocationId":"e-e4ef633d-823c-4f29-884a-7245ca2762cc","author":"semantic_visual_reviewer","actions":{"stateDelta":{"final_validation_result":{"grade":"pass","comment":"A análise semântica e visual de todas as variações foi concluída. Cada variação está perfeitamente alinhada com o briefing, o objetivo de vendas e a narrativa StoryBrand. A Variação 1 foca na jornada da 'vergonha' ao 'orgulho'. A Variação 2 aborda o ângulo da 'segurança' e 'alívio'. A Variação 3 foca no dilema do 'preço justo' e na 'satisfação' da compra inteligente. Em todos os casos, a consistência entre copy e visual é exemplar, e os prompts de imagem são coerentes e acionáveis. Não há problemas de conformidade. O conjunto está aprovado."}},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"zuuT4QP9","timestamp":1761483888.595661}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"invocationId":"","author":"semantic_validation_escalator","actions":{"stateDelta":{},"artifactDelta":{},"escalate":false,"requestedAuthConfigs":{}},"id":"DIPaxnYe","timestamp":1761483888.597743}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"Skipping semantic_fix_agent; review passed."}]},"invocationId":"","author":"semantic_fix_if_failed","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"shHejyaL","timestamp":1761483888.600495}
INFO:app.agent:ImageAssetsAgent: Keys in state: ['landing_page_url', 'objetivo_final', 'perfil_cliente', 'formato_anuncio', 'foco', 'implementation_plan', 'format_specs', 'format_specs_json', 'planning_mode', 'nome_empresa', 'o_que_a_empresa_faz', 'sexo_cliente_alvo', 'force_storybrand_fallback', 'reference_image_character_summary', 'reference_image_product_summary', 'reference_image_safe_search_notes', 'reference_image_character_gcs_uri', 'reference_image_character_labels', 'reference_image_character_user_description', 'reference_image_product_gcs_uri', 'reference_image_product_labels', 'reference_image_product_user_description', 'reference_images', 'reference_image_summary', 'cta_instagram_choices', 'cta_by_objective', 'recommended_cta', 'orchestrator_has_run', 'extracted_input', 'feature_snippet', 'especificacao_tecnica_da_ui', 'contexto_api', 'fonte_da_verdade_ux', 'extraction_status', 'original_docs', 'landing_page_analysis_failed', 'landing_page_context', 'storybrand_audit_trail', 'storybrand_gate_metrics', 'storybrand_fallback_meta', 'storybrand_gate_debug', 'fallback_input_review', 'storybrand_enriched_inputs', 'storybrand_character', 'storybrand_character_review', 'exposition_1', 'exposition_1_review', 'inciting_incident_1', 'inciting_incident_1_review', 'exposition_2', 'exposition_2_review', 'inciting_incident_2', 'inciting_incident_2_review', 'unmet_needs_summary', 'unmet_needs_summary_review', 'storybrand_problem_external', 'storybrand_problem_external_review', 'storybrand_problem_internal', 'storybrand_problem_internal_review', 'storybrand_problem_philosophical', 'storybrand_problem_philosophical_review', 'storybrand_guide', 'storybrand_guide_review', 'storybrand_value_proposition', 'storybrand_value_proposition_review', 'storybrand_plan', 'storybrand_plan_review', 'storybrand_action', 'storybrand_action_review', 'storybrand_failure', 'storybrand_failure_review', 'storybrand_success', 'storybrand_success_review', 'storybrand_identity', 'storybrand_identity_review', 'storybrand_sections_saved_path', 'storybrand_sections_gcs_uri', 'storybrand_analysis', 'storybrand_summary', 'storybrand_ad_context', 'storybrand_recovery_report', 'feature_briefing', 'landing_context_enriched', 'implementation_tasks', 'current_task_index', 'total_tasks', 'approved_code_snippets', 'current_task_info', 'current_task_description', 'generated_code', 'code_review_result', 'approval_confirmation', 'approved_visual_drafts', 'deterministic_final_blocked', 'delivery_audit_trail', 'final_ad_variations', 'final_code_delivery', 'final_code_delivery_parsed', 'deterministic_final_validation', 'semantic_visual_review', 'final_validation_result']
INFO:app.agent:ImageAssetsAgent: final_code_delivery exists: True
WARNING:app.agent:ImageAssetsAgent: invalid reference metadata detected: ['character reference invalid: [{\'type\': \'value_error\', \'loc\': (\'uploaded_at\',), \'msg\': "Value error, Invalid isoformat string: \'2025-10-26T12:47:43.789085Z\'", \'input\': \'2025-10-26T12:47:43.789085Z\', \'ctx\': {\'error\': ValueError("Invalid isoformat string: \'2025-10-26T12:47:43.789085Z\'")}, \'url\': \'https://errors.pydantic.dev/2.11/v/value_error\'}]', 'product reference invalid: [{\'type\': \'value_error\', \'loc\': (\'uploaded_at\',), \'msg\': "Value error, Invalid isoformat string: \'2025-10-26T12:47:58.958653Z\'", \'input\': \'2025-10-26T12:47:58.958653Z\', \'ctx\': {\'error\': ValueError("Invalid isoformat string: \'2025-10-26T12:47:58.958653Z\'")}, \'url\': \'https://errors.pydantic.dev/2.11/v/value_error\'}]']
INFO:app.agent:{"event": "image_assets_generation_start", "session_id": "eb5ff994-78a8-45d3-a471-beeaf379c28b", "user_id": "anonymous", "total_variations": 3, "character_reference_available": false, "product_reference_available": false, "reference_images_present": true, "reference_images": {"character": {"id": "ref_ca145efb197e411b86542749e64ed4c7", "type": "character", "gcs_uri": "gs://instagram-ads-472021-reference-images/reference-images/anonymous/session/character/ref_ca145efb197e411b86542749e64ed4c7.jpg", "labels": ["Blue", "Sleeve", "Collar", "Button", "Formal wear", "Textile", "Dress shirt", "Pocket", "Facial hair", "Cuff"], "safe_search_flags": {"adult": "VERY_UNLIKELY", "violence": "VERY_UNLIKELY", "racy": "VERY_UNLIKELY", "medical": "UNLIKELY", "spoof": "VERY_UNLIKELY"}, "user_description": null, "uploaded_at": "2025-10-26T12:47:43.789085+00:00", "signed_url_expires_at": "2025-10-27T12:47:43.789085+00:00", "signed_url_ttl_seconds": 86400}, "product": {"id": "ref_e37af7ffb71548c1900cce4f35da6c82", "type": "product", "gcs_uri": "gs://instagram-ads-472021-reference-images/reference-images/anonymous/session/product/ref_e37af7ffb71548c1900cce4f35da6c82.jpg", "labels": ["Blue", "Recreation", "Leisure", "Vacation", "Adventure", "Water sport", "Windsport"], "safe_search_flags": {"adult": "VERY_UNLIKELY", "violence": "VERY_UNLIKELY", "racy": "UNLIKELY", "medical": "VERY_UNLIKELY", "spoof": "VERY_UNLIKELY"}, "user_description": null, "uploaded_at": "2025-10-26T12:47:58.958653+00:00", "signed_url_expires_at": "2025-10-27T12:47:58.958653+00:00", "signed_url_ttl_seconds": 86400}}, "reference_parse_errors": ["character reference invalid: [{'type': 'value_error', 'loc': ('uploaded_at',), 'msg': \"Value error, Invalid isoformat string: '2025-10-26T12:47:43.789085Z'\", 'input': '2025-10-26T12:47:43.789085Z', 'ctx': {'error': ValueError(\"Invalid isoformat string: '2025-10-26T12:47:43.789085Z'\")}, 'url': 'https://errors.pydantic.dev/2.11/v/value_error'}]", "product reference invalid: [{'type': 'value_error', 'loc': ('uploaded_at',), 'msg': \"Value error, Invalid isoformat string: '2025-10-26T12:47:58.958653Z'\", 'input': '2025-10-26T12:47:58.958653Z', 'ctx': {'error': ValueError(\"Invalid isoformat string: '2025-10-26T12:47:58.958653Z'\")}, 'url': 'https://errors.pydantic.dev/2.11/v/value_error'}]"], "safe_search_notes": null}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"🎨 Iniciando geração de imagens para variação 1/3."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"d9JgDqcx","timestamp":1761483888.605059}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 1: etapa 1/3 (estado atual) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"aYTbiuC4","timestamp":1761483900.097919}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 1: etapa 2/3 (estado intermediário) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"LDeyKIR0","timestamp":1761483913.606608}
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:app.tools.generate_transformation_images:Geração de imagens concluída para variação 0 em 34.37s
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 1: etapa 3/3 (estado aspiracional) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"xbqCGMYj","timestamp":1761483922.982623}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"🎉 Variação 1: imagens geradas e anexadas ao JSON."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"PKAYrCpf","timestamp":1761483922.983176}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"🎨 Iniciando geração de imagens para variação 2/3."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"XB7Yw8r8","timestamp":1761483922.983537}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 2: etapa 1/3 (estado atual) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"4W5QB9Bb","timestamp":1761483932.83505}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 2: etapa 2/3 (estado intermediário) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"Ttec8feq","timestamp":1761483947.108165}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:app.tools.generate_transformation_images:Geração de imagens concluída para variação 1 em 33.79s
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 2: etapa 3/3 (estado aspiracional) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"2r8Bkm01","timestamp":1761483956.776627}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"🎉 Variação 2: imagens geradas e anexadas ao JSON."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"DdMc5gu7","timestamp":1761483956.77719}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"🎨 Iniciando geração de imagens para variação 3/3."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"z0jMM658","timestamp":1761483956.77762}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 3: etapa 1/3 (estado atual) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"6m3mlkP5","timestamp":1761483967.00993}
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 3: etapa 2/3 (estado intermediário) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"2jLfc6DJ","timestamp":1761483979.800063}
INFO:google_genai.models:AFC is enabled with max remote calls: 10.
INFO:httpx:HTTP Request: POST https://us-central1-aiplatform.googleapis.com/v1beta1/projects/instagram-ads-472021/locations/us-central1/publishers/google/models/gemini-2.5-flash-image:generateContent "HTTP/1.1 200 OK"
INFO:google_genai.models:AFC remote call 1 is done.
INFO:app.tools.generate_transformation_images:Geração de imagens concluída para variação 2 em 32.72s
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Variação 3: etapa 3/3 (estado aspiracional) concluída."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"bivHi9Oj","timestamp":1761483989.502031}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"🎉 Variação 3: imagens geradas e anexadas ao JSON."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"GUnd6pt9","timestamp":1761483989.503433}
INFO:app.agent:ImageAssetsAgent: URLs de imagens adicionadas ao normalized_payload (3 variações)
INFO:app.utils.audit:delivery_audit_event
INFO:app.agent:{"event": "image_assets_generation_complete", "session_id": "eb5ff994-78a8-45d3-a471-beeaf379c28b", "user_id": "anonymous", "grade": "pass", "generated_variations": 3, "generated_any": true, "critical_errors": null, "character_reference_used": false, "product_reference_used": false, "reference_images_present": true, "reference_images": {"character": {"id": "ref_ca145efb197e411b86542749e64ed4c7", "type": "character", "gcs_uri": "gs://instagram-ads-472021-reference-images/reference-images/anonymous/session/character/ref_ca145efb197e411b86542749e64ed4c7.jpg", "labels": ["Blue", "Sleeve", "Collar", "Button", "Formal wear", "Textile", "Dress shirt", "Pocket", "Facial hair", "Cuff"], "safe_search_flags": {"adult": "VERY_UNLIKELY", "violence": "VERY_UNLIKELY", "racy": "VERY_UNLIKELY", "medical": "UNLIKELY", "spoof": "VERY_UNLIKELY"}, "user_description": null, "uploaded_at": "2025-10-26T12:47:43.789085+00:00", "signed_url_expires_at": "2025-10-27T12:47:43.789085+00:00", "signed_url_ttl_seconds": 86400}, "product": {"id": "ref_e37af7ffb71548c1900cce4f35da6c82", "type": "product", "gcs_uri": "gs://instagram-ads-472021-reference-images/reference-images/anonymous/session/product/ref_e37af7ffb71548c1900cce4f35da6c82.jpg", "labels": ["Blue", "Recreation", "Leisure", "Vacation", "Adventure", "Water sport", "Windsport"], "safe_search_flags": {"adult": "VERY_UNLIKELY", "violence": "VERY_UNLIKELY", "racy": "UNLIKELY", "medical": "VERY_UNLIKELY", "spoof": "VERY_UNLIKELY"}, "user_description": null, "uploaded_at": "2025-10-26T12:47:58.958653+00:00", "signed_url_expires_at": "2025-10-27T12:47:58.958653+00:00", "signed_url_ttl_seconds": 86400}}, "reference_parse_errors": ["character reference invalid: [{'type': 'value_error', 'loc': ('uploaded_at',), 'msg': \"Value error, Invalid isoformat string: '2025-10-26T12:47:43.789085Z'\", 'input': '2025-10-26T12:47:43.789085Z', 'ctx': {'error': ValueError(\"Invalid isoformat string: '2025-10-26T12:47:43.789085Z'\")}, 'url': 'https://errors.pydantic.dev/2.11/v/value_error'}]", "product reference invalid: [{'type': 'value_error', 'loc': ('uploaded_at',), 'msg': \"Value error, Invalid isoformat string: '2025-10-26T12:47:58.958653Z'\", 'input': '2025-10-26T12:47:58.958653Z', 'ctx': {'error': ValueError(\"Invalid isoformat string: '2025-10-26T12:47:58.958653Z'\")}, 'url': 'https://errors.pydantic.dev/2.11/v/value_error'}]"], "safe_search_notes": null}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"📊 Resultado da geração de imagens:\n• Variação 1: ok\n• Variação 2: ok\n• Variação 3: ok"}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"QhQRm4Ne","timestamp":1761483989.505732}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Imagens geradas e salvas (variações bem-sucedidas: 3/3)."}]},"invocationId":"","author":"image_assets_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"Tc6xP5r1","timestamp":1761483989.507017}
INFO:app.callbacks.persist_outputs:Final delivery saved locally: artifacts/ads_final/20251026-100629_eb5ff994-78a8-45d3-a471-beeaf379c28b_Feed.json
INFO:app.callbacks.persist_outputs:Final delivery uploaded to GCS: gs://instagram-ads-472021-deliveries/deliveries/u_999/eb5ff994-78a8-45d3-a471-beeaf379c28b/20251026-100629_eb5ff994-78a8-45d3-a471-beeaf379c28b_Feed.json
INFO:app.callbacks.persist_outputs:Final delivery meta saved locally: artifacts/ads_final/meta/eb5ff994-78a8-45d3-a471-beeaf379c28b.json
INFO:app.callbacks.persist_outputs:Final delivery meta uploaded to GCS: gs://instagram-ads-472021-deliveries/deliveries/u_999/eb5ff994-78a8-45d3-a471-beeaf379c28b/meta.json
INFO:app.callbacks.persist_outputs:{"event": "final_delivery_persisted", "session_id": "eb5ff994-78a8-45d3-a471-beeaf379c28b", "user_id": "u_999", "stage": "deterministic_final_validation", "grade": "pass", "local_path": "artifacts/ads_final/20251026-100629_eb5ff994-78a8-45d3-a471-beeaf379c28b_Feed.json", "gcs_uri": "gs://instagram-ads-472021-deliveries/deliveries/u_999/eb5ff994-78a8-45d3-a471-beeaf379c28b/20251026-100629_eb5ff994-78a8-45d3-a471-beeaf379c28b_Feed.json", "reference_images_present": true, "reference_images": {"character": {"id": "ref_ca145efb197e411b86542749e64ed4c7", "type": "character", "gcs_uri": "gs://instagram-ads-472021-reference-images/reference-images/anonymous/session/character/ref_ca145efb197e411b86542749e64ed4c7.jpg", "labels": ["Blue", "Sleeve", "Collar", "Button", "Formal wear", "Textile", "Dress shirt", "Pocket", "Facial hair", "Cuff"], "safe_search_flags": {"adult": "VERY_UNLIKELY", "violence": "VERY_UNLIKELY", "racy": "VERY_UNLIKELY", "medical": "UNLIKELY", "spoof": "VERY_UNLIKELY"}, "user_description": null, "uploaded_at": "2025-10-26T12:47:43.789085+00:00", "signed_url_expires_at": "2025-10-27T12:47:43.789085+00:00", "signed_url_ttl_seconds": 86400}, "product": {"id": "ref_e37af7ffb71548c1900cce4f35da6c82", "type": "product", "gcs_uri": "gs://instagram-ads-472021-reference-images/reference-images/anonymous/session/product/ref_e37af7ffb71548c1900cce4f35da6c82.jpg", "labels": ["Blue", "Recreation", "Leisure", "Vacation", "Adventure", "Water sport", "Windsport"], "safe_search_flags": {"adult": "VERY_UNLIKELY", "violence": "VERY_UNLIKELY", "racy": "UNLIKELY", "medical": "VERY_UNLIKELY", "spoof": "VERY_UNLIKELY"}, "user_description": null, "uploaded_at": "2025-10-26T12:47:58.958653+00:00", "signed_url_expires_at": "2025-10-27T12:47:58.958653+00:00", "signed_url_ttl_seconds": 86400}}, "image_signed_url_ttl_seconds": 86400}
INFO:app.utils.audit:delivery_audit_event
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"💾 JSON final persistido com sucesso."}]},"invocationId":"","author":"persist_final_delivery_agent","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"xtLXcgTz","timestamp":1761483991.465105}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ **PRONTO** – JSON final do anúncio disponível (estágio `deterministic_final_validation`, nota `pass`).\n\n• Validação determinística: `pass`\n• Revisão semântica: `pass`\n• Revisão de imagens: `pass`"}]},"invocationId":"","author":"status_reporter_final","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"tCrgsUdQ","timestamp":1761483991.466506}
INFO:google_adk.google.adk.cli.fast_api:Generated event in agent run streaming: {"content":{"parts":[{"text":"✅ Anúncio (JSON) gerado e validado!"}]},"invocationId":"","author":"FeatureOrchestrator","actions":{"stateDelta":{},"artifactDelta":{},"requestedAuthConfigs":{}},"id":"QRmgu4XL","timestamp":1761483991.46749}
Sending Request to the Target: GET /delivery/final/meta?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b
INFO:     127.0.0.1:52536 - "GET /delivery/final/meta?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b HTTP/1.1" 200 OK
Received Response from the Target: 200 /delivery/final/meta?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b
Sending Request to the Target: GET /delivery/final/download?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b&inline=1
INFO:     127.0.0.1:40500 - "GET /delivery/final/download?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b&inline=1 HTTP/1.1" 200 OK
Received Response from the Target: 200 /delivery/final/download?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b&inline=1
Sending Request to the Target: GET /delivery/final/download?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b
INFO:     127.0.0.1:54926 - "GET /delivery/final/download?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b HTTP/1.1" 200 OK
Received Response from the Target: 200 /delivery/final/download?user_id=u_999&session_id=eb5ff994-78a8-45d3-a471-beeaf379c28b