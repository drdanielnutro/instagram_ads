{
  "agent": "writer-agent",
  "task_id": "TASK-20251016-0000",
  "phase": "implementation",
  "reference_plan": "PLANO_IMPLEMENTACAO_ENUMS_FINAL_DELIVERY.md",
  "scope": {
    "phases_to_implement": ["FASE 1", "FASE 2", "FASE 5"],
    "skip_phases": ["FASE 3", "FASE 4", "FASE 6"]
  },
  "files_to_modify": [
    {
      "path": "app/schemas/final_delivery.py",
      "actions": [
        "Adicionar imports: enum",
        "Criar 3 enums declarativos ANTES dos modelos (linhas 92-133 do plano)",
        "Refatorar StrictAdCopy: trocar str por CtaInstagramEnum, remover @field_validator",
        "Refatorar StrictAdVisual: trocar str por AspectRatioEnum, remover @field_validator",
        "Refatorar StrictAdItem: trocar str por FormatoAnuncioEnum e CtaInstagramEnum, remover 2 @field_validator",
        "CRÍTICO: Ajustar @model_validator para usar .value em 3 locais (linhas 341, 349, 362 do plano)"
      ]
    }
  ],
  "files_to_create": [
    {
      "path": "tests/unit/schemas/test_enum_sync.py",
      "template": "Código completo nas linhas 402-479 do plano",
      "tests": ["test_cta_enum_sincronizado_com_config", "test_formato_enum_sincronizado_with_format_specs", "test_aspect_ratio_enum_sincronizado", "test_enums_tem_quantidade_correta"]
    },
    {
      "path": "tests/unit/schemas/test_final_delivery_enums.py",
      "template": "Código completo nas linhas 482-628 do plano",
      "tests": ["test_cta_enum_aceita_valores_validos", "test_cta_enum_rejeita_valor_invalido", "test_strict_ad_item_com_enums_validos", "test_feed_aceita_dois_aspect_ratios", "test_reels_so_aceita_9_16", "test_pydantic_converte_strings_para_enums"]
    },
    {
      "path": "tests/unit/schemas/test_pydantic_json_schema.py",
      "template": "Código completo nas linhas 631-663 do plano",
      "tests": ["test_enum_gera_campo_enum_no_json_schema"]
    }
  ],
  "critical_instructions": [
    "USAR CÓDIGO EXATO DO PLANO - é copy-pasteable e testado",
    "VALIDAR linha-por-linha contra plano ao modificar @model_validator",
    "ADICIONAR .value em EXATAMENTE 3 locais: FORMAT_SPECS.get(self.formato.value), f-strings com self.formato.value, self.visual.aspect_ratio.value",
    "MANTER @field_validator('contexto_landing') - não é enum",
    "MANTER @model_validator - apenas adicionar .value",
    "EXECUTAR pytest tests/unit/schemas/test_enum_sync.py -v após Fase 1 para confirmar sincronização"
  ],
  "validation_checklist": [
    "Enums declarados com herança (str, enum.Enum)",
    "Docstrings dos enums citam fontes canônicas",
    "@field_validator removidos apenas para cta_texto, aspect_ratio, formato, cta_instagram",
    "@field_validator('contexto_landing') mantido",
    "@model_validator usa .value ao acessar FORMAT_SPECS e comparar strings",
    "Todos os 3 arquivos de teste criados com código completo do plano",
    "Testes executam sem erros de import"
  ],
  "acceptance_criteria": [
    "uv run pytest tests/unit/schemas/test_enum_sync.py -v passa 4/4 testes",
    "uv run pytest tests/unit/schemas/test_final_delivery_enums.py -v passa 6/6 testes",
    "uv run pytest tests/unit/schemas/test_pydantic_json_schema.py -v -s mostra campo 'enum' no schema",
    "uv run pytest tests/unit/validators/test_final_delivery_validator.py -v continua passando (validador compatível)",
    "make lint passa sem erros"
  ]
}
